import React from 'react';
import PropTypes from 'prop-types';
import trackerevents from '../utils/ChangeTrackerEvents';

const tagTypes = ['input', 'select'];

class FormChangeTracker extends React.Component {

	getEvent() {
		return [this.props.route.path, 'formchange'].join(':');
	}

	isValidTag(e) {
		const tag = e.target.tagName.toLowerCase();
		return tagTypes.indexOf(tag) !== -1;
	}

	handleBlur(e) {
		if (!this.isValidTag(e)) { return; }
		trackerevents.trigger(this.getEvent());
	}

	render() {
		return (
			<div onBlur={this.handleBlur.bind(this)}>{this.props.children}</div>
		);
	}

}

FormChangeTracker.propTypes = {
	children: PropTypes.node.isRequired,
	route: PropTypes.object.isRequired
};

export default FormChangeTracker;
