import { isValidFid } from './Fid';

const isValidLanguage = language => language && language.length === 2;

export { isValidLanguage };

/**
 * All paths use a prefix since we deploy under prefixes in PRODUCTION
 * Url should look like: http://domain/<app-namespace>/<name-of-any-view>
 *
 * @returns	{String}
 */
export default () => {
	const [, appname, language, appfid] = window.location.pathname.split('/');
	const basenames = [
		{
			path: `/${appname}/${language}/${appfid}`,
			isMatch: isValidLanguage(language) && isValidFid(appfid)
		},
		{
			path: `/${appname}/${language}`,
			// Yes the fid would in this case be in the language position
			// While we maintain backward compatibility
			isMatch: isValidFid(language)
		},
		{
			path: `/${appname}`,
			isMatch: !isValidFid(appfid) && !isValidFid(language)
		}
	];

	const [basename] = basenames.filter(name => name.isMatch);

	return basename.path;
};
