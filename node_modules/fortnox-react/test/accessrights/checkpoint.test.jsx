import React from 'react';
import 'utils/AjaxStub';
import { mount } from 'enzyme';
import Checkpoint from 'accessrights/Checkpoint';

describe('Checkpoint', () => {
	const target = <div id="alpacas" />;
	const denied = <h2>Ã…tkomst nekad</h2>;

	const assertEnabled = (done, component) => {
		const mounted = mount(component);

		setTimeout(() => {
			mounted.update().contains(target).should.be.true();
			mounted.update().contains(denied).should.be.false();
			done();
		}, 0);
	};

	const assertDisabled = (done, component) => {
		const mounted = mount(component);

		setTimeout(() => {
			mounted.update().contains(target).should.be.false();
			mounted.update().contains(denied).should.be.true();
			done();
		}, 0);
	};

	it('Renders a child when the assertion string passes', (done) => {
		assertEnabled(done, (
			<Checkpoint assert="bf.altervoucher">
				{target}
			</Checkpoint>
		));
	});

	it('Renders a message when the assertion string fails', (done) => {
		assertDisabled(done, (
			<Checkpoint assert="bf.doodad">
				{target}
			</Checkpoint>
		));
	});

	it('Renders a child when the assertion function passes', (done) => {
		assertEnabled(done, (
			<Checkpoint assert={rights => rights.has('bf.altervoucher')}>
				{target}
			</Checkpoint>
		));
	});

	it('Renders a message when the assertion function fails', (done) => {
		assertDisabled(done, (
			<Checkpoint assert={rights => rights.has('bf.doodad')}>
				{target}
			</Checkpoint>
		));
	});
});
