import React from 'react';
import ReactDOM from 'react-dom';
import TestUtils from 'react-dom/test-utils';
import Backbone from 'utils/BackboneAdapter';
import FieldText from 'form/TextBox';
import FieldPhone from 'form/OrganizationNumber';

import 'utils/AjaxStub'

const writeInPhoneField = (component, input, value) => {
	input.value = value;
	TestUtils.Simulate.change(ReactDOM.findDOMNode(input));
	TestUtils.Simulate.blur(ReactDOM.findDOMNode(input));
};

describe('Form FieldOrganizationnumber', () => {

	it('Correctly validates a phone number', done => {
		const m = new Backbone.Model();
		const component = TestUtils.renderIntoDocument(
			<FieldPhone model={m} modelProp="phoneno" />
		);
		const input = TestUtils.findRenderedDOMComponentWithTag(component, 'input');
		const instance = TestUtils.findRenderedComponentWithType(component, FieldText);

		writeInPhoneField(component, input, 'abc');
		instance.state.isValid.should.be.false();

		writeInPhoneField(component, input, '556469-6291');
		instance.state.isValid.should.be.true();

		writeInPhoneField(component, input, '5564696291');
		instance.state.isValid.should.be.true();

		writeInPhoneField(component, input, '801002-9620');
		instance.state.isValid.should.be.true();

		writeInPhoneField(component, input, '801002-96201');
		instance.state.isValid.should.be.false();

		done();
	});

});
