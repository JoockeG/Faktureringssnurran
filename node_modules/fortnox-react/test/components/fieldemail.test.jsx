import React from 'react';
import ReactDOM from 'react-dom';
import TestUtils from 'react-dom/test-utils';
import Backbone from 'utils/BackboneAdapter';
import FieldText from 'form/TextBox';
import FieldEmail from 'form/Email';

import 'utils/AjaxStub'

describe('Form FieldEmail', () => {

	it('Validates Email correctly', done => {
		const m = new Backbone.Model({Â email: 'foo@animal.com' });
		const component = TestUtils.renderIntoDocument(
			<FieldEmail model={m} modelProp="email" />
		);
		const input = TestUtils.findRenderedDOMComponentWithTag(component, 'input');
		TestUtils.findRenderedComponentWithType(component, FieldText).state.isValid.should.be.true();
		input.value.should.equal('foo@animal.com');

		input.value = 'invalidEmailadress';
		TestUtils.Simulate.change( ReactDOM.findDOMNode(input) );
		TestUtils.Simulate.blur( ReactDOM.findDOMNode(input) );

		TestUtils.findRenderedComponentWithType(component, FieldText).state.isValid.should.be.false();

		input.value = 'valid@Email.com';
		TestUtils.Simulate.change( ReactDOM.findDOMNode(input) );
		TestUtils.Simulate.blur( ReactDOM.findDOMNode(input) );

		TestUtils.findRenderedComponentWithType(component, FieldText).state.isValid.should.be.true();

		done();
	});

});
